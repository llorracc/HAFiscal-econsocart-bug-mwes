% workaround.sty
% Fixes garbled headers in econsocart.cls for QE submissions
% Bug: Odd-page headers show both journal name and title (concatenated)
%
% Usage: \usepackage{workaround}
%        (Load after \end{frontmatter})
%
% Author: Christopher Carroll
% Date: November 4, 2025

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{workaround}[2025/11/04 Fix for econsocart QE header bug]

% Fix page headers for Quantitative Economics submissions
% Root cause: econsocart.cls lines 1953-1956 treat QE incorrectly
%
% Strategy: Directly redefine \@oddhead and \@evenhead to show clean headers
%   - Even pages (left): Journal name + page number
%   - Odd pages (right): Paper title + page number
%
% CRITICAL: Must execute after \end{frontmatter} which sets up headers

\RequirePackage{etoolbox}

\makeatletter

% Hook into \end{frontmatter} to apply fix after econsocart sets headers
\AtEndPreamble{%
  % Must wrap in \AtBeginDocument to ensure it runs AFTER \end{frontmatter}
  \AtBeginDocument{%
    % Give econsocart a chance to set up its headers first
    \@ifclassloaded{econsocart}{%
      % Check if draft mode is active (line numbers present)
      \@ifundefined{put@numberlines@box}{%
        % REGULAR MODE: No line numbers
        \def\@oddhead{%
          \runninghead@size\hfill\@runtitle\hfill\llap{\pagenumber@size\thepage}%
        }%
        \def\@evenhead{%
          \runninghead@size\rlap{\pagenumber@size\thepage}\hfill Submitted to Quantitative Economics\hfill%
        }%
      }{%
        % DRAFT MODE: Preserve line numbers box
        \def\@oddhead{%
          \runninghead@size\hfill\@runtitle\hfill\llap{\pagenumber@size\thepage}\put@numberlines@box%
        }%
        \def\@evenhead{%
          \runninghead@size\rlap{\pagenumber@size\thepage}\hfill Submitted to Quantitative Economics\hfill\put@numberlines@box%
        }%
      }%
    }{%
      % Not using econsocart - nothing to fix
      \PackageWarning{workaround}{This package only works with econsocart.cls}%
    }%
  }%
}

\makeatother

\endinput

